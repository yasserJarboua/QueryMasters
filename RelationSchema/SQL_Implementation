CREATE DATABASE IF NOT EXISTS MNHS_DB;
USE MNHS_DB;

CREATE TABLE IF NOT EXISTS Patient (
    IID INT PRIMARY KEY,
    CIN VARCHAR(20) UNIQUE
        CHECK (CIN REGEXP '^[A-Za-z0-9]+$'),
    Name VARCHAR(100) NOT NULL
        CHECK (Name REGEXP '^[A-Za-z ]+$'),
    Sex CHAR(1)
        CHECK (Sex IN ('M', 'F')),
    Birth DATE NOT NULL
        CHECK (Birth <= CURRENT_DATE),
    BloodGroup VARCHAR(5)
        CHECK (BloodGroup IN ('A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-')),
    Phone VARCHAR(15)
        CHECK (Phone REGEXP '^[0-9]{10,15}$')
);

CREATE TABLE IF NOT EXISTS Staff (
    Staff_ID INT PRIMARY KEY,
    Name VARCHAR(50) NOT NULL,
    Status VARCHAR(50) NOT NULL
);

CREATE TABLE IF NOT EXISTS Practitioner (
    Staff_ID INT PRIMARY KEY,
    LicenseNumber VARCHAR(20) NOT NULL,
    Specialty VARCHAR(50) NOT NULL,
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Caregiving (
    Staff_ID INT PRIMARY KEY,
    Ward VARCHAR(100),
    Grade VARCHAR(100),
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Technical (
    Staff_ID INT PRIMARY KEY,
    Modality VARCHAR(100),
    Certifications VARCHAR(100),
    Grade VARCHAR(100),
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Hospital (
    HID INT PRIMARY KEY,
    Name VARCHAR(50) NOT NULL,
    City VARCHAR(50),
    Region VARCHAR(50)
);

CREATE TABLE IF NOT EXISTS Department (
    DEP_ID INT PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    Specialty VARCHAR(100),
    HID INT NOT NULL,
    FOREIGN KEY (HID) REFERENCES Hospital(HID)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS WorkIn(
    Staff_ID INT NOT NULL,
    DEP_ID INT NOT NULL,
    PRIMARY KEY (Staff_ID, DEP_ID),
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID)
        ON DELETE CASCADE,
    FOREIGN KEY (DEP_ID) REFERENCES Department(DEP_ID)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS ClinicalActivity (
    CAID INT PRIMARY KEY,
    Date DATE NOT NULL,
    Time TIME NOT NULL,
    IID INT NOT NULL,
    Staff_ID INT NOT NULL,
    DEP_ID INT NOT NULL,
    FOREIGN KEY (IID) REFERENCES Patient(IID)
        ON DELETE NO ACTION,
    FOREIGN KEY (Staff_ID) REFERENCES Staff(Staff_ID)
        ON DELETE NO ACTION,
    FOREIGN KEY (DEP_ID) REFERENCES Department(DEP_ID)
        ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS Appointment (
    CAID INT PRIMARY KEY,
    Reason VARCHAR(255),
    Status VARCHAR(50) NOT NULL,
    FOREIGN KEY (CAID) REFERENCES ClinicalActivity(CAID)
        ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS Emergency(
    CAID INT PRIMARY KEY,
    TriageLevel VARCHAR(50) NOT NULL,
    Outcome VARCHAR(50),
    FOREIGN KEY (CAID) REFERENCES ClinicalActivity(CAID)
        ON DELETE CASCADE
);
